<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IoT Dashboard + Flying Satellite</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, sans-serif;
      color: #222;
      background: transparent;
      overflow-x: hidden;
    }
    #space {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      background: radial-gradient(circle at bottom, #00111a, #000 90%);
    }
    .dashboard {
      position: relative;
      z-index: 1;
      padding: 20px;
      text-align: center;
      min-height: 100vh;
    }
    h1 {
      margin-bottom: 30px;
      color: #fff;
      text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    .card {
      background: rgba(255,255,255,0.9);
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0,0,0,0.3);
    }
    h2 { margin-bottom: 10px; color: #333; }
    canvas { max-width: 100%; }
    .gauge-label {
      margin-top: 10px;
      font-size: 18px;
      font-weight: bold;
      color: #444;
    }
  </style>
</head>
<body>
  <canvas id="space"></canvas>
  <div class="dashboard">
    <h1>üåê IoT Sensor Dashboard</h1>
    <div class="grid">
      <div class="card"><h2>üå° Temperature (¬∞C)</h2><canvas id="tempChart"></canvas></div>
      <div class="card"><h2>üíß Humidity (%)</h2><canvas id="humChart"></canvas></div>
    </div>
    <div class="grid">
      <div class="card"><h2>‚òÄÔ∏è UV Index</h2><canvas id="uvChart"></canvas></div>
      <div class="card"><h2>üî• Gas Sensor</h2><canvas id="gasChart"></canvas></div>
    </div>
    <h2 style="color:white; text-shadow:2px 2px 6px black;">üìä Average Values</h2>
    <div class="grid">
      <div class="card"><canvas id="tempGauge"></canvas><div class="gauge-label">Temperature Avg (¬∞C)</div></div>
      <div class="card"><canvas id="humGauge"></canvas><div class="gauge-label">Humidity Avg (%)</div></div>
      <div class="card"><canvas id="uvGauge"></canvas><div class="gauge-label">UV Avg</div></div>
      <div class="card"><canvas id="gasGauge"></canvas><div class="gauge-label">Gas Avg (ppm)</div></div>
    </div>
  </div>

  <script>
    /* === Background Satellite Animation === */
    const canvas = document.getElementById("space");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    let angle = 0;
    const stars = Array.from({length: 200}, () => ({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.5
    }));
    function drawStars() {
      ctx.fillStyle = "white";
      stars.forEach(s => { ctx.beginPath(); ctx.arc(s.x, s.y, s.r, 0, Math.PI*2); ctx.fill(); });
    }
    function drawSatellite(x, y) {
      const bodyW = 100, bodyH = 200;
      ctx.shadowColor = "rgba(0,0,0,0.8)";
      ctx.shadowBlur = 20;
      const gradient = ctx.createLinearGradient(x, y, x + bodyW, y);
      gradient.addColorStop(0, "#b30000");
      gradient.addColorStop(0.5, "#ff0000");
      gradient.addColorStop(1, "#800000");
      ctx.fillStyle = gradient;
      ctx.fillRect(x, y, bodyW, bodyH);
      ctx.fillStyle = "purple";
      ctx.beginPath(); ctx.arc(x+bodyW/2,y,bodyW/2,Math.PI,0,false); ctx.fill();
      ctx.beginPath(); ctx.arc(x+bodyW/2,y+bodyH,bodyW/2,0,Math.PI,false); ctx.fill();
      ctx.strokeStyle = "gray"; ctx.lineWidth = 6;
      ctx.beginPath(); ctx.moveTo(x,y+bodyH/2); ctx.lineTo(x-80,y+bodyH/2); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(x+bodyW,y+bodyH/2); ctx.lineTo(x+bodyW+80,y+bodyH/2); ctx.stroke();
      function drawPanel(px,py) {
        ctx.fillStyle = "#0f172a"; ctx.fillRect(px,py,140,90);
        ctx.strokeStyle = "#444"; ctx.strokeRect(px,py,140,90);
        ctx.fillStyle = "#1e40af";
        for(let i=0;i<3;i++){ for(let j=0;j<4;j++){ ctx.fillRect(px+j*35+5,py+i*28+5,25,20); } }
      }
      drawPanel(x-220,y+bodyH/2-45); drawPanel(x+bodyW+80,y+bodyH/2-45);
      ctx.shadowBlur = 0;
    }
    function animate() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawStars();
      const centerX = canvas.width/2;
      const centerY = canvas.height/2;
      const floatY = centerY + Math.sin(angle)*50;
      const floatX = centerX + Math.cos(angle*0.5)*150;
      drawSatellite(floatX-50,floatY-100);
      angle += 0.01;
      requestAnimationFrame(animate);
    }
    animate();

    /* === Line Charts === */
    async function loadCSV() {
      const response = await fetch("data.csv");
      const text = await response.text();
      return parseCSV(text);
    }
    function parseCSV(text) {
      const rows = text.trim().split("\n");
      const data = rows.slice(1).map(r=>{
        const cols=r.split(",");
        return {time:cols[0],temp:+cols[1],hum:+cols[2],uv:+cols[3],gas:+cols[4]};
      });
      return {
        labels:data.map(r=>r.time),
        temp:data.map(r=>r.temp),
        hum:data.map(r=>r.hum),
        uv:data.map(r=>r.uv),
        gas:data.map(r=>r.gas)
      };
    }
    function makeChart(ctx,label,data,color){
      return new Chart(ctx,{
        type:"line",
        data:{labels:window.labels,datasets:[{label,data,borderColor:color,backgroundColor:color+"33",fill:true,tension:0.4}]},
        options:{responsive:true,plugins:{legend:{display:true}}}
      });
    }

    /* === Full Circle Gauge with Arc Stop === */
    const fullGaugeNeedle = {
      id: "fullGaugeNeedle",
      afterDatasetDraw(chart) {
        const { ctx, chartArea: { width, height } } = chart;
        const cx = width / 2 + chart.chartArea.left;
        const cy = height / 2 + chart.chartArea.top;
        const radius = Math.min(width, height) / 2.6;

        const val = chart.data.datasets[0].needleValue;
        const max = chart.options.max;
        const angle = (val / max) * 2 * Math.PI - Math.PI / 2;

        ctx.save();
        ctx.translate(cx, cy);
        ctx.strokeStyle = "#333";
        ctx.fillStyle = "#000";
        ctx.font = "bold 14px Segoe UI";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        // Draw ticks + numbers
        for (let i = 0; i <= 10; i++) {
          const tickAngle = (i / 10) * 2 * Math.PI - Math.PI / 2;
          const tx = Math.cos(tickAngle) * radius;
          const ty = Math.sin(tickAngle) * radius;

          ctx.beginPath();
          ctx.moveTo(Math.cos(tickAngle) * (radius - 8), Math.sin(tickAngle) * (radius - 8));
          ctx.lineTo(tx, ty);
          ctx.stroke();

          const labelVal = Math.round((i / 10) * max);
          ctx.fillText(labelVal, Math.cos(tickAngle) * (radius + 18), Math.sin(tickAngle) * (radius + 18));
        }
        ctx.restore();

        // Arc up to needle (colored)
        ctx.beginPath();
        ctx.arc(cx, cy, radius - 15, -Math.PI/2, angle, false);
        ctx.lineWidth = 6;
        ctx.strokeStyle = chart.data.datasets[0].backgroundColor[0];
        ctx.stroke();

        // Arc after needle (gray)
        ctx.beginPath();
        ctx.arc(cx, cy, radius - 15, angle, 1.5*Math.PI, false);
        ctx.lineWidth = 6;
        ctx.strokeStyle = "#e0e0e0";
        ctx.stroke();

        // Needle
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(angle);
        ctx.beginPath();
        ctx.moveTo(-5, 0);
        ctx.lineTo(radius - 20, 0);
        ctx.lineWidth = 4;
        ctx.strokeStyle = "#e74c3c";
        ctx.stroke();
        ctx.restore();

        // Value text
        ctx.font = "bold 18px Segoe UI";
        ctx.fillStyle = "#111";
        ctx.textAlign = "center";
        ctx.fillText(val.toFixed(1) + " " + (chart.options.unit || ""), cx, cy + radius + 35);
      }
    };

    function makeFullGauge(ctx, value, max, color, unit = "") {
      return new Chart(ctx, {
        type: "doughnut",
        data: {
          datasets: [{
            data: [value, max - value],
            needleValue: value,
            backgroundColor: [color, "#e0e0e0"],
            borderWidth: 0
          }]
        },
        options: {
          rotation: -90,
          circumference: 360,
          cutout: "70%",
          plugins: { legend: { display: false } },
          max: max,
          unit: unit
        },
        plugins: [fullGaugeNeedle]
      });
    }

    /* === Build Charts & Gauges === */
    loadCSV().then(data=>{
      window.labels=data.labels;
      makeChart(document.getElementById("tempChart"),"Temperature",data.temp,"#e74c3c");
      makeChart(document.getElementById("humChart"),"Humidity",data.hum,"#3498db");
      makeChart(document.getElementById("uvChart"),"UV",data.uv,"#9b59b6");
      makeChart(document.getElementById("gasChart"),"Gas",data.gas,"#2ecc71");

      let avgTemp=data.temp.reduce((a,b)=>a+b,0)/data.temp.length;
      let avgHum=data.hum.reduce((a,b)=>a+b,0)/data.hum.length;
      let avgUv=data.uv.reduce((a,b)=>a+b,0)/data.uv.length;
      let avgGas=data.gas.reduce((a,b)=>a+b,0)/data.gas.length;

      makeFullGauge(document.getElementById("tempGauge"),avgTemp,50,"#e74c3c","¬∞C");
      makeFullGauge(document.getElementById("humGauge"),avgHum,100,"#3498db","%");
      makeFullGauge(document.getElementById("uvGauge"),avgUv,11,"#9b59b6","UV");
      makeFullGauge(document.getElementById("gasGauge"),avgGas,500,"#2ecc71","ppm");
    });
  </script>
</body>
</html>